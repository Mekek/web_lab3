<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="/templates/templLayout.xhtml">

    <ui:define name="head">
        <title>Lab3 - Main page</title>
    </ui:define>

    <ui:define name="main">

        <h1 class="main__title">Web-programming, Lab 3</h1>

        <div class="main__row">

            <div class="main__left-block">
                <canvas id="graph"/>

                <h:form id="form" styleClass="form">

                    <!-- X -->
                    <label class="form__label">X</label>
                    <div id="xInput">
                        <p:inputText id="XValue"
                                     value="#{results.currResult.x}"
                                     placeholder="-5 ... 3">
                            <f:validator validatorId="validatorX"/>
                        </p:inputText>
                    </div>

                    <!-- Y -->
                    <label class="form__label">Y</label>
                    <div class="form__row" id="yCheckboxes">

                        <c:forEach items="#{results.yValues}" var="yv">
                            <h:selectBooleanCheckbox
                                    value="#{results.ySelection[yv]}"
                                    id="y_#{yv}">
                                <f:ajax render="yCheckboxes"/>
                            </h:selectBooleanCheckbox>
                            <label for="y_#{yv}">#{yv}</label>
                        </c:forEach>

                    </div>

                    <!-- R -->
                    <label class="form__label">R</label>
                    <div class="form__row">
                        <p:selectOneRadio id="RValue" value="#{results.currResult.r}" layout="pageDirection">
                            <f:selectItem itemLabel="1" itemValue="1"/>
                            <f:selectItem itemLabel="2" itemValue="2"/>
                            <f:selectItem itemLabel="3" itemValue="3"/>
                            <f:selectItem itemLabel="4" itemValue="4"/>
                            <f:selectItem itemLabel="5" itemValue="5"/>
                        </p:selectOneRadio>
                    </div>

                    <!-- Buttons -->
                    <div class="form__row form__btn-row">
                        <p:commandButton id="submitBtn" styleClass="big-btn" value="Submit"
                                         action="#{results.addPoint(results.currResult.x, results.currResult.y, results.currResult.r)}"
                                         update="results-table"
                                         oncomplete="updateDotsOnGraphFromTable();"/>
                        <p:commandButton id="clearBtn" styleClass="big-btn" value="Clear"
                                         action="#{results.clearResults}"
                                         immediate="true"
                                         update="results-table"
                                         oncomplete="updateDotsOnGraphFromTable();"/>
                        <h:inputHidden id="source" value="#{results.source}" />
                    </div>
                </h:form>

                <!-- Messages -->
                <p:messages id="messagesC" showSummary="false" showDetail="true" closable="true"/>
                <p:messages id="messagesS" showSummary="false" showDetail="true" closable="true">
                    <p:autoUpdate/>
                </p:messages>
            </div>

            <!-- Table -->
            <div class="main__table-block">
                <p:dataTable id="results-table"
                             tableStyleClass="main__table"
                             var="result"
                             value="#{results.resultList}"
                             emptyMessage="">
                    <p:column headerText="X">
                        <h:outputText value="#{result.x}" />
                    </p:column>

                    <p:column headerText="Y">
                        <h:outputText value="#{result.y}" />
                    </p:column>

                    <p:column headerText="R">
                        <h:outputText value="#{result.r}" />
                    </p:column>

                    <p:column headerText="Result">
                        <h:outputText styleClass="#{result.classSuccess}" value="#{result.stringSuccess}" />
                    </p:column>

                    <p:column headerText="Time">
                        <h:outputText value="#{result.requestTime}" />
                    </p:column>
                </p:dataTable>
            </div>
        </div>
    </ui:define>

    <ui:define name="js">
        <h:outputScript name="js/main.js"/>
        <h:outputScript name="js/graph.js"/>
        <script type="text/javascript">
            function selectOnlyOneY(selectedCheckbox) {
                var checkboxes = document.querySelectorAll('#yCheckboxes input[type=checkbox]');
                checkboxes.forEach(function(cb) {
                    if(cb !== selectedCheckbox) cb.checked = false;
                });
            }
        </script>
    </ui:define>

</ui:composition>
</html>
